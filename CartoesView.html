<!-- =============================================================================
     CartoesView — Template HTML para lista de cartões
     Injetado no DOM pelo scripts.html via App.renderCartoesView()
     ============================================================================= -->
<script id="tpl-cartoes-view" type="text/html">
  <div class="cartoes-view" id="cartoesView">

    <!-- Barra de filtros + busca -->
    <div class="filter-bar">
      <div class="search-wrap">
        <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input
          type="search"
          id="searchInput"
          class="search-input"
          placeholder="Buscar por nome, banco ou bandeira..."
          autocomplete="off"
          oninput="App.onSearch(this.value)"
          aria-label="Buscar cartões"
        >
      </div>
      <div class="filter-right">
        <div class="tab-group" role="tablist" aria-label="Filtro de status">
          <button class="tab-btn active" id="tabAtivos"   onclick="App.filterStatus('ativos')"    role="tab" aria-selected="true">
            Ativos <span class="tab-badge" id="badgeAtivos">0</span>
          </button>
          <button class="tab-btn"        id="tabArquivados" onclick="App.filterStatus('arquivados')" role="tab" aria-selected="false">
            Arquivados <span class="tab-badge" id="badgeArquivados">0</span>
          </button>
        </div>
        <select class="sort-select" id="sortSelect" onchange="App.onSort(this.value)" aria-label="Ordenar por">
          <option value="pct_desc">% Uso ↓</option>
          <option value="venc_asc">Vencimento ↑</option>
          <option value="nome_asc">Nome A-Z</option>
        </select>
      </div>
    </div>

    <!-- Resumo rápido (KPIs topo) -->
    <div class="kpi-row" id="kpiRow" style="display:none">
      <div class="kpi-chip">
        <span class="kpi-label">Limite total</span>
        <span class="kpi-val" id="kpiLimTotal">—</span>
      </div>
      <div class="kpi-chip">
        <span class="kpi-label">Usado</span>
        <span class="kpi-val danger" id="kpiLimUsado">—</span>
      </div>
      <div class="kpi-chip">
        <span class="kpi-label">Disponível</span>
        <span class="kpi-val ok" id="kpiLimDisp">—</span>
      </div>
    </div>

    <!-- Grid de cartões -->
    <div class="cards-grid" id="cardsGrid" role="list">
      <!-- Preenchido por renderCartoesList() -->
    </div>

    <!-- Estado vazio -->
    <div id="emptyState" class="empty-state" style="display:none">
      <div class="empty-icon">
        <svg width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
          <rect x="2" y="5" width="20" height="14" rx="3"/>
          <line x1="2" y1="10" x2="22" y2="10"/>
        </svg>
      </div>
      <h3 id="emptyTitle">Nenhum cartão encontrado</h3>
      <p id="emptyDesc">Adicione seu primeiro cartão clicando no botão "+".</p>
      <button class="btn-primary" onclick="App.openAddCard()">Adicionar cartão</button>
    </div>

    <!-- Sincronizando indicator -->
    <div id="syncIndicator" class="sync-indicator" style="display:none" aria-live="polite">
      <span class="sync-dot"></span> Sincronizando...
    </div>

  </div>
</script>

<!-- =============================================================================
     Template de card individual
     ============================================================================= -->
<script id="tpl-cartao-card" type="text/html">
  <div class="cartao-card {alertClass}" data-id="{id}" role="listitem" tabindex="0"
       onclick="App.openDetalhe('{id}')" onkeydown="if(event.key==='Enter')App.openDetalhe('{id}')">

    <!-- Cabeçalho colorido do card (visual do cartão) -->
    <div class="card-visual" style="background: linear-gradient(135deg, {cor}, {corDark})">
      <div class="card-visual-top">
        <div class="card-chip">
          <svg width="28" height="22" viewBox="0 0 28 22" fill="none">
            <rect width="28" height="22" rx="3" fill="#FFD700" opacity="0.9"/>
            <line x1="0" y1="7" x2="28" y2="7" stroke="#B8860B" stroke-width="1"/>
            <line x1="0" y1="15" x2="28" y2="15" stroke="#B8860B" stroke-width="1"/>
            <line x1="10" y1="0" x2="10" y2="22" stroke="#B8860B" stroke-width="1"/>
            <line x1="18" y1="0" x2="18" y2="22" stroke="#B8860B" stroke-width="1"/>
          </svg>
        </div>
        <div class="card-bandeira">{bandeiraSvg}</div>
      </div>
      <div class="card-visual-bot">
        <div class="card-ult4">{ult4Display}</div>
        <div class="card-nome-vis">{nome}</div>
      </div>
    </div>

    <!-- Corpo do card -->
    <div class="card-body">
      <div class="card-header-row">
        <div class="card-info">
          <span class="card-nome">{nome}</span>
          <span class="card-emissor">{emissor}</span>
        </div>
        <div class="card-actions" onclick="event.stopPropagation()">
          <button class="action-btn" onclick="App.openEditCard('{id}')" title="Editar" aria-label="Editar {nome}">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
              <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
            </svg>
          </button>
          <button class="action-btn {archiveBtnClass}" onclick="App.toggleArchive('{id}', {ativoInvert})" title="{archiveLabel}" aria-label="{archiveLabel} {nome}">
            {archiveIcon}
          </button>
        </div>
      </div>

      <!-- Barra de uso -->
      <div class="usage-section">
        <div class="usage-labels">
          <span class="usage-used">Usado: {limUsadoFmt}</span>
          <span class="usage-pct {pctClass}">{pct_uso}%</span>
        </div>
        <div class="progress-bar" role="progressbar" aria-valuenow="{pct_uso}" aria-valuemin="0" aria-valuemax="100" aria-label="Uso do limite">
          <div class="progress-fill {pctClass}" style="width:{pct_uso}%"></div>
        </div>
        <div class="usage-footer">
          <span>Disponível: {limDispFmt}</span>
          <span class="total-lim">Total: {limTotalFmt}</span>
        </div>
      </div>

      <!-- Datas -->
      <div class="dates-row">
        <div class="date-chip {alertVencClass}">
          <span class="date-label">Vencimento</span>
          <span class="date-val">{prox_vencimento}</span>
        </div>
        <div class="date-chip">
          <span class="date-label">Fechamento</span>
          <span class="date-val">{prox_fechamento}</span>
        </div>
        <div class="date-chip melhor">
          <span class="date-label">Melhor dia</span>
          <span class="date-val">Dia {melhor_dia_compra}</span>
        </div>
      </div>

      <!-- Alertas -->
      <div class="alerts-row" id="alerts_{id}">
        {alertsHtml}
      </div>
    </div>

    <!-- Overlay de sincronização (optimistic UI) -->
    <div class="sync-overlay" id="sync_{id}" style="display:none">
      <div class="sync-spinner"></div>
    </div>
  </div>
</script>

<!-- =============================================================================
     Template do Modal de criação/edição de cartão
     ============================================================================= -->
<script id="tpl-modal-cartao" type="text/html">
  <div class="modal-header">
    <h2 id="modalTitle">{modalTitulo}</h2>
    <button class="modal-close" onclick="App.closeModal()" aria-label="Fechar modal">&times;</button>
  </div>

  <form id="formCartao" class="modal-form" onsubmit="App.submitCartao(event)" novalidate autocomplete="off">
    <input type="hidden" id="fcId"      value="{id}">
    <input type="hidden" id="fcVersion" value="{version}">

    <div class="form-grid">
      <!-- Linha 1: Nome + Emissor -->
      <div class="form-field">
        <label for="fcNome">Nome do cartão <span class="req">*</span></label>
        <input type="text" id="fcNome" placeholder="Ex: Nubank, Inter Black" value="{nome}" required maxlength="60">
        <span class="field-error" id="errNome"></span>
      </div>
      <div class="form-field">
        <label for="fcEmissor">Banco / Emissor <span class="req">*</span></label>
        <input type="text" id="fcEmissor" placeholder="Ex: Nubank, Banco Inter" value="{emissor}" required maxlength="60">
        <span class="field-error" id="errEmissor"></span>
      </div>

      <!-- Linha 2: Bandeira + Últimos 4 dígitos -->
      <div class="form-field">
        <label for="fcBandeira">Bandeira <span class="req">*</span></label>
        <select id="fcBandeira" required>
          <option value="">Selecione...</option>
          <option value="Visa"   {selVisa}>Visa</option>
          <option value="Master" {selMaster}>Mastercard</option>
          <option value="Amex"   {selAmex}>Amex</option>
          <option value="Elo"    {selElo}>Elo</option>
          <option value="Outro"  {selOutro}>Outro</option>
        </select>
        <span class="field-error" id="errBandeira"></span>
      </div>
      <div class="form-field">
        <label for="fcUlt4">Últimos 4 dígitos</label>
        <input type="text" id="fcUlt4" placeholder="1234" value="{ult4}" maxlength="4" pattern="[0-9]{4}" inputmode="numeric">
      </div>

      <!-- Linha 3: Limite total + Limite usado -->
      <div class="form-field">
        <label for="fcLimTotal">Limite total (R$) <span class="req">*</span></label>
        <input type="number" id="fcLimTotal" placeholder="5000.00" value="{limite_total}" min="0" step="0.01" required>
        <span class="field-error" id="errLimTotal"></span>
      </div>
      <div class="form-field">
        <label for="fcLimUsado">Limite usado (R$)</label>
        <input type="number" id="fcLimUsado" placeholder="0.00" value="{limite_usado}" min="0" step="0.01">
      </div>

      <!-- Linha 4: Dia fechamento + Dia vencimento -->
      <div class="form-field">
        <label for="fcDiaFech">Dia fechamento <span class="req">*</span></label>
        <input type="number" id="fcDiaFech" placeholder="10" value="{dia_fechamento}" min="1" max="31" required>
        <span class="field-error" id="errDiaFech"></span>
      </div>
      <div class="form-field">
        <label for="fcDiaVenc">Dia vencimento <span class="req">*</span></label>
        <input type="number" id="fcDiaVenc" placeholder="17" value="{dia_vencimento}" min="1" max="31" required>
        <span class="field-error" id="errDiaVenc"></span>
      </div>

      <!-- Preview melhor dia de compra -->
      <div class="form-field full-width">
        <div class="melhor-dia-preview" id="melhorDiaPreview">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/>
          </svg>
          <span>Melhor dia de compra: <strong id="melhorDiaVal">—</strong></span>
        </div>
      </div>

      <!-- Cor do cartão -->
      <div class="form-field full-width">
        <label>Cor do cartão</label>
        <div class="color-picker-row" id="colorPickerRow">
          <button type="button" class="color-swatch {selCor1}" data-cor="#5B5FEF" style="background:#5B5FEF" onclick="App.selectCor('#5B5FEF', this)"></button>
          <button type="button" class="color-swatch {selCor2}" data-cor="#820AD1" style="background:#820AD1" onclick="App.selectCor('#820AD1', this)"></button>
          <button type="button" class="color-swatch {selCor3}" data-cor="#FF7A00" style="background:#FF7A00" onclick="App.selectCor('#FF7A00', this)"></button>
          <button type="button" class="color-swatch {selCor4}" data-cor="#0EA47A" style="background:#0EA47A" onclick="App.selectCor('#0EA47A', this)"></button>
          <button type="button" class="color-swatch {selCor5}" data-cor="#E53E3E" style="background:#E53E3E" onclick="App.selectCor('#E53E3E', this)"></button>
          <button type="button" class="color-swatch {selCor6}" data-cor="#1A73E8" style="background:#1A73E8" onclick="App.selectCor('#1A73E8', this)"></button>
          <button type="button" class="color-swatch {selCor7}" data-cor="#2D3748" style="background:#2D3748" onclick="App.selectCor('#2D3748', this)"></button>
          <label class="color-custom-wrap" title="Cor personalizada">
            <input type="color" id="fcCorCustom" value="{cor}" onchange="App.selectCor(this.value, null)">
            <span class="color-swatch custom-swatch" style="background:{cor}">+</span>
          </label>
        </div>
        <input type="hidden" id="fcCor" value="{cor}">
      </div>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn-ghost" onclick="App.closeModal()">Cancelar</button>
      <button type="submit" class="btn-primary" id="btnSalvarCartao">
        <span class="btn-label">{btnLabel}</span>
        <span class="btn-loading">Salvando...</span>
      </button>
    </div>
  </form>
</script>
